{"version":3,"names":[],"sources":["ContentProtectionIntegration.ts"],"sourcesContent":["import type { CertificateRequest, LicenseRequest } from './ContentProtectionRequest';\nimport type { CertificateResponse, LicenseResponse } from './ContentProtectionResponse';\n\n/**\n * A synchronous or asynchronous return type\n *\n * @public\n */\nexport type MaybeAsync<T> = T | PromiseLike<T>;\n\nexport type BufferSource = ArrayBufferView | ArrayBuffer;\n\n/**\n * This ContentProtectionIntegration defines some methods to alter license and certificate requests and responses.\n *\n * @public\n */\nexport interface ContentProtectionIntegration {\n  /**\n   * Handler which will be called when a HTTP request for a new certificate is about to be sent.\n   *\n   * @remarks\n   * If a valid certificate was provided as part of the {@link KeySystemConfiguration.certificate}, this handler will not be called.\n   * The handler must return either a request or a raw certificate. When a (possibly modified) request is returned,\n   * the player will send that request instead of the original request. When a raw certificate is returned,\n   * the request is skipped entirely and the certificate is used directly. If no handler is provided, the player sends the original request.\n   *\n   * For example, an integration may want to “wrap” the request body in a different format (e.g. JSON or XML) for\n   * certain DRM vendors, or add additional authentication tokens to the request.\n   * Alternatively, an integration may want to send the HTTP request using its own network stack,\n   * and return the final certificate response to the player.\n   *\n   * @param request - The {@link CertificateRequest} that is about to be sent.\n   */\n  onCertificateRequest?(request: CertificateRequest): MaybeAsync<Partial<CertificateRequest> | BufferSource>;\n\n  /**\n   * Handler which will be called when a HTTP request for a certificate returns a response.\n   *\n   * @remarks\n   * The handler will be called regardless of the HTTP status code on the response (i.e. also for unsuccessful statuses outside of the 200-299 range).\n   * The handler must return the raw certificate, in a manner suitable for further processing by the CDM.\n   * If no handler is provided, the player uses the response body as raw certificate, but only if the response’s status indicates success.\n   *\n   * For example, an integration may want to “unwrap” a wrapped JSON or XML response body, turning it into a raw certificate.\n   *\n   * @param response - The {@link CertificateResponse} that was returned from the certificate request.\n   */\n  onCertificateResponse?(response: CertificateResponse): MaybeAsync<BufferSource>;\n\n  /**\n   * Handler which will be called when a HTTP request for a new license is about to be sent.\n   *\n   * @remarks\n   * The handler must return either a request or a raw license. When a (possibly modified) request is returned,\n   * the player will send that request instead of the original request. When a raw license is returned,\n   * the request is skipped entirely and the license is used directly. If no handler is provided, the player sends the original request.\n   *\n   * For example, an integration may want to “wrap” the request body in a different format (e.g. JSON or XML) for certain DRM vendors,\n   * or add additional authentication tokens to the request. Alternatively, an integration may want to send the HTTP request using its own network stack,\n   * and return the final license response to the player.\n   *\n   * @param request - The {@link LicenseRequest} that is about to be sent.\n   */\n  onLicenseRequest?(request: LicenseRequest): MaybeAsync<Partial<LicenseRequest> | BufferSource>;\n\n  /**\n   * Handler which will be called when a HTTP request for a license returns an response.\n   *\n   * @remarks\n   * The handler will be called regardless of the HTTP status code on the response (i.e. also for unsuccessful statuses outside of the 200-299 range).\n   * The handler must return the raw license, in a manner suitable for further processing by the CDM.\n   * If no handler is provided, the player uses the response body as raw license, but only if the response’s status indicates success.\n   *\n   * For example, an integration may want to “unwrap” a wrapped JSON or XML response body, turning it into a raw license.\n   *\n   * @param response - The {@link LicenseResponse} that was returned from the license request.\n   */\n  onLicenseResponse?(response: LicenseResponse): MaybeAsync<BufferSource>;\n\n  /**\n   * A function to extract the Fairplay content ID from the key URI, as given by the URI attribute of the `#EXT-X-KEY` tag in the HLS playlist (m3u8).\n   *\n   * @remarks\n   * In order to start a Fairplay license request, the player must provide the initialization data, the content ID and the certificate to the CDM.\n   * The content ID is usually contained in the key URI in some vendor-specific way, for example in the host name (e.g. `skd://123456789`)\n   * or in the URL query (e.g. `skd://vendor?123456789`). This function should extract this content ID from the key URI.\n   * This method is required only for Fairplay integrations. It is ignored for other key systems.\n   *\n   * @param skdUrl - The key URI.\n   */\n  extractFairplayContentId?(skdUrl: string): MaybeAsync<string>;\n}\n"],"mappings":""}